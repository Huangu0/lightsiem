input {

        lumberjack {
                port => 9030
                ssl_certificate => "/etc/logstash/ssl/logstash-forwarder.crt"
                ssl_key => "/etc/logstash/ssl/logstash-forwarder.key"
                type => auditd

                codec => multiline {
                         pattern => "^----"
                         negate => true
                         what => "previous"
                }
        }


        #Stdin input for debug purposes
        stdin {
                type => auditd

                codec => multiline {
                         pattern => "^----"
                         negate => true
                         what => "previous"
                }
        }

}

filter {

        if [type] == "auditd" {

                grok {
                        #match => { "message" => "%{DATA}type=EXECVE msg=audit\(%{DATESTAMP}:%{NUMBER}\) \: %{DATA:execve_arguments} \\n%{DATA}\\ntype=SYSCALL %{DATA} auid=%{USERNAME:user} %{GREEDYDATA}" }
                        match => { "message" => "%{DATA}type=EXECVE msg=audit\(%{DATESTAMP}:%{NUMBER}\) \: %{DATA:execve_arguments} \n%{DATA}\ntype=SYSCALL %{DATA} auid=%{USERNAME:user} %{GREEDYDATA}" }

                }

                mutate {
                        add_field => [ "Alert.Sensor.Node.Name", "%{host}" ]
                        #gsub => [ "execve_arguments", "a", "" ]
                }

        }

}